(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{455:function(e,t,r){"use strict";r.d(t,"b",function(){return n}),r.d(t,"a",function(){return a});var i=r(358),n=function(e){var t=new FileReader;return new Promise(function(r,i){try{t.readAsDataURL(e),t.onloadend=function(){r(t.result)}}catch(e){throw new Error("Ошибка при чтении файла")}})},a=function(e){var t=i.a.defaults.baseURL;return"".concat(t,"/").concat(e)}},456:function(e,t,r){},476:function(e,t){},483:function(e,t,r){"use strict";var i=r(456);r.n(i).a},502:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("adding-form",{attrs:{title:e.title,disabled:e.disableForm,buttonsPadding:"0 20% 0 0"},on:{submit:function(t){"add"===e.mode?e.addNewReview():e.editCurrentReview()},cancel:e.closeForm}},[r("div",{staticClass:"reviews__form-content",attrs:{slot:"form-content"},slot:"form-content"},[r("div",{staticClass:"reviews__form-userpic"},[r("label",{staticClass:"reviews__form-avatar-upload",class:{error:e.validation.hasError("review.photo")}},[r("input",{staticClass:"reviews__form-file-input",attrs:{type:"file"},on:{change:e.handlePhotoUpload}}),r("div",{staticClass:"reviews__form-pic"},[r("div",{staticClass:"reviews__form-avatar-empty",class:{filled:e.renderedAvatar.length},style:{backgroundImage:e.userAvatarUrl}})]),r("div",{staticClass:"reviews__form-addphoto"},[e._v("Добавить фото")]),r("div",{staticClass:"reviews__avatar-error"},[r("errors-tooltip",{attrs:{errorText:e.validation.firstError("review.photo")}})],1)])]),r("div",{staticClass:"reviews__form-col"},[r("div",{staticClass:"reviews__form-row"},[r("div",{staticClass:"reviews__form-block"},[r("app-input",{attrs:{title:"Имя автора",errorText:e.validation.firstError("review.author")},model:{value:e.review.author,callback:function(t){e.$set(e.review,"author",t)},expression:"review.author"}})],1),r("div",{staticClass:"reviews__form-block"},[r("app-input",{attrs:{title:"Титул автора",errorText:e.validation.firstError("review.occ")},model:{value:e.review.occ,callback:function(t){e.$set(e.review,"occ",t)},expression:"review.occ"}})],1)]),r("div",{staticClass:"reviews__form-row"},[r("div",{staticClass:"reviews__form-block"},[r("app-input",{attrs:{title:"Отзыв","field-type":"textarea",errorText:e.validation.firstError("review.text")},model:{value:e.review.text,callback:function(t){e.$set(e.review,"text",t)},expression:"review.text"}})],1)])])])])};i._withStripped=!0;var n=r(137),a=r(455),o=r(465);function s(e,t,r,i,n,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(i,n)}function c(e){return function(){var t=this,r=arguments;return new Promise(function(i,n){var a=e.apply(t,r);function o(e){s(a,i,n,o,c,"next",e)}function c(e){s(a,i,n,o,c,"throw",e)}o(void 0)})}}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),i.forEach(function(t){l(e,t,r[t])})}return e}function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var v={mixins:[r(465).mixin],validators:{"review.author":function(e){return o.Validator.value(e).required("Заполните автора")},"review.occ":function(e){return o.Validator.value(e).required("Укажите роль автора")},"review.text":function(e){return o.Validator.value(e).required("Введите текст отзыва")},"review.photo":function(e){return o.Validator.value(e).required("Вставьте аватар")}},components:{appInput:function(){return r.e(3).then(r.bind(null,508))},appButton:function(){return r.e(0).then(r.bind(null,507))},addingForm:function(){return r.e(11).then(r.bind(null,500))},errorsTooltip:function(){return r.e(2).then(r.bind(null,494))}},data:function(){return{renderedAvatar:"",disableForm:!1,review:{id:0,author:"",occ:"",text:"",photo:""}}},props:{title:{type:String,default:"Новый отзыв"},mode:{type:String,default:"add",validator:function(e){return["add","edit"].includes(e)}}},computed:u({},Object(n.d)("reviews",{currentReview:function(e){return e.currentReview}}),{userAvatarUrl:function(){return"url(".concat(this.renderedAvatar,")")}}),watch:{currentReview:function(e){"edit"===this.mode&&this.fillFormWithCurrentReviewData()}},created:function(){"edit"===this.mode&&this.fillFormWithCurrentReviewData()},methods:u({},Object(n.b)("reviews",["addReview","updateReview"]),Object(n.b)("tooltips",["showTooltip"]),{closeForm:function(){this.review={},this.$emit("cancel")},editCurrentReview:function(){var e=c(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==this.$validate()){e.next=2;break}return e.abrupt("return");case 2:return this.disableForm=!0,e.prev=3,e.next=6,this.updateReview(this.review);case 6:e.sent,this.$emit("cancel"),this.showTooltip({type:"success",text:"Работа обновлена"}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),this.showTooltip({type:"error",text:e.t0.message});case 14:return e.prev=14,this.disableForm=!1,this.validation.reset(),e.finish(14);case 18:case"end":return e.stop()}},e,this,[[3,11,14,18]])}));return function(){return e.apply(this,arguments)}}(),addNewReview:function(){var e=c(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$validate();case 2:if(e.t0=e.sent,!1!==e.t0){e.next=5;break}return e.abrupt("return");case 5:return this.disableForm=!0,e.prev=6,e.next=9,this.addReview(this.review);case 9:e.sent,this.clearFormFields(),this.showTooltip({type:"success",text:"Отзыв добавлен"}),e.next=17;break;case 14:e.prev=14,e.t1=e.catch(6),this.showTooltip({type:"error",text:e.t1.message});case 17:return e.prev=17,this.disableForm=!1,this.valdation.reset(),e.finish(17);case 21:case"end":return e.stop()}},e,this,[[6,14,17,21]])}));return function(){return e.apply(this,arguments)}}(),clearFormFields:function(){this.review={},this.renderedAvatar=""},fillFormWithCurrentReviewData:function(){this.review=u({},this.currentReview),this.renderedAvatar=Object(a.a)(this.currentReview.photo)},handlePhotoUpload:function(){var e=c(regeneratorRuntime.mark(function e(t){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.target.files[0],this.review.photo=r,e.prev=2,e.next=5,Object(a.b)(r);case 5:i=e.sent,this.renderedAvatar=i,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),this.showTooltip({type:"error",text:"Ошибка во время обработки файла"});case 12:case"end":return e.stop()}},e,this,[[2,9]])}));return function(t){return e.apply(this,arguments)}}()})},d=(r(483),r(96)),f=Object(d.a)(v,i,[],!1,null,"46b6a48f",null);f.options.__file="src/admin/components/reviews-add.vue";t.default=f.exports}}]);